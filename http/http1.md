# <img src="../images/icon/http.png" width="30" height="30" />HTTP协议

---

**HTTP 是建立在TCP/IP协议上的超文本传输协议，一般用来做WEB项目的开发。一开始HTTP的最初设想的基本理念是能
让远隔两地的研究者们共享知识的设想，后来经过不断的发展，已经普遍到了人们的生活当中**

<img src="../images/icon/http.png" width="180" height="180" />

**HTTP协议是「无状态」的，协议本身不对请求和响应之间的通信状态进行保存，也就是说在HTTP这个级别，协议对于发送
过的请求和响应都不做持久化处理。因为HTTP是无状态协议，就无法根据之前的状态进行本次的请求处理，比如用户登录，
每次跳转新页面的时候就要重新进行认证，为了解决这个问题，就引入了Cookie技术，Cookie会根据从服务器端发送的响应
报文内的一个叫做Set-Cookie的首部字段，通知客户端保存Cookie，当下次客户端再往该服务器发送请求时，客户端会自动
在请求报文中加入Cookie值后发送出去**

## TCP/IP协议族

计算机与网络设备通信的所有规则（比如如何探测到通信目标、由那一边先发起通信、使用哪种语言、怎样结束通信，不同的
硬件、操作系统之间的通信都需要一种规则）称为协议，把互联网相关联的协议集合起来总称为TCP/IP，TCP/IP是互联网
相关的各类协议族的总称

## TCP/IP分层

* 应用层

应用层决定了向用户提供应用服务时通信的活动，HTTP协议也处于该层

* 传输层

传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输，在传输层有两个性质不同的协议：TCP和UDP

* 网络层

网络层用来处理在网络上流动的数据包，数据包是网络传输的最小单位，与对方计算机之间通过多台计算机或网络设备进行
传输时，网络层所起的作用就是在众多的选项内选择一天传输路线

* 链路层

用来处理网络中的硬件部分（操作系统、网卡等），硬件上的范畴均在链路层的作用范围之内

## 确保可靠的TCP协议

按层次分，TCP协议位于传输层，提供可靠的字节流服务，为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理，而且
TCP协议能够确认数据最终是否送达到对方，为了准确无误的将数据送达目标处，TCP协议采用了三次握手策略，在传送后，它会向对方
确认是否成功送达，握手过程中使用了TCP的标志：SYN和ACK

###握手过程

1.发送端首先发送一个带有SYN的标志数据包给对方

2.接收端收到后，回传一个带有SYN/ACK的标志数据包以示传达确认

3.最后，发送端回传一个带有ACK标志的数据包，代表握手结束

## DNS

**DNS服务和HTTP一样位于应用层的协议，提供域名到IP地址之间的解析服务**

计算机可以被赋予IP地址以及域名，用户通常使用主机名或域名来访问对方的计算机，而不是直接通过IP地址，域名相对于人来说比较容易记忆，
但是计算机比较擅长处理一长串的数字，为了解决这个问题，DNS协议可以通过域名查找IP地址，或逆向通过IP地址反查域名

## URI和URL

URI为统一资源标识符，URL为统一资源定位符，URI用字符串标识某一互联网资源，而URL表示资源的地点，所以URL是URI的子集

## 持久连接

在HTTP协议的初始版本中，每一次进行HTTP通信就要断开一次TCP连接，但如果浏览器请求的资源过多时，不停的对TCP连接进行建立和断开，就会
增加通信量的开销，为了解决这样的问题，HTTP1.1和部分的HTTP1.0出现了持久链接的方法，只要任一一端没有明确提出断开连接，则保持TCP连接
状态

## HTTP报文

**用于HTTP「协议交互」的信息被称为HTTP「报文」，客户端的HTTP报文叫做请求报文，服务器端的叫做响应报文，HTTP报文本身是由多行数据构成的
字符串文本，HTTP报文大致可分为报文首部和报文主体两块，两者由最初出现的空行来划分。通常，并不一定要有报文主体。**

## 报文结构

* 报文首部

**服务器端或客户端需处理的请求或相应的内容及属性**

* 报文首部结构

| 请求报文首部结构 | 作用 |
| :- | :- |
| 请求行 | 方法、URI、HTTP版本 |
| 请求首部字段 | 从客户端向服务器发送请求报文时使用的首部。补充了请求的附加内容、客户端信息、响应内容相关优先级等信息 |
| 通用首部字段 | 请求报文和响应报文两方都会使用的首部 |
| 实体首部字段 | 针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有关的信息 |
| 其他 | ~~ |

| 响应报文首部结构 | 作用 |
| :- | :- |
| 状态行 | HTTP版本、状态码 |
| 响应首部字段 | 从服务器向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会要求客户端附加额外的内容信息 |
| 通用首部字段 | 请求报文和响应报文两方都会使用的首部 |
| 实体首部字段 | 针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有关的信息 |
| 其他 | ~~ |

* 报文主体

**应该被发送的数据**

## 内容协商

**内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为合适的资源。内容协商会以语言、字符集、编码方式
等为基准判断响应的资源**

* 包含在请求报文中的某些首部字段就是判断的基准，HTTP/1.1 规范定义了如下 47 种首部字段。

> 通用首部字段

| 字段名称 | 字段作用 |
| :-: | :-: |
| Cache-Control | 控制缓存的行为 |
| Connection | 逐跳首部、链接的管理 |
| Date | 创建报文的日期时间 |
| Pragma | 报文指令 |
| Trailer | 报文末端的首部一览 |
| Transfer——Encoding | 指定报文主体的传输编码方式 |
| Upgrade | 升级为其他协议 |
| Via | 代理服务器的相关信息 |
| Warning | 错误通知 |

> 请求首部字段

| 字段名称 | 字段作用 |
| :- | :- |
| Accept | 用户代理可处理的媒体类型 |
| Accept-Charset  | 优先的字符集 |
| Accept-Encoding | 优先的内容编码 |
| Accept-Language | 优先的语言（自然语言） |
| Authorization | Web认证信息 |
| Expect | 期待服务器的特定行为 |
| From | 用户的电子邮箱地址 |
| Host | 请求资源所在服务器 |
| If-Match | 比较实体标记（ETag） |
| If-Modified-Since | 比较资源的更新时间 |
| If-None-Match | 比较实体标记（与 If-Match 相反） |
| If-Range | 资源未更新时发送实体 Byte 的范围请求 |
| If-Unmodified-Since | 比较资源的更新时间（与If-Modified-Since相反） |
| Max-Forwards  | 最大传输逐跳数 |
| Proxy-Authorization | 代理服务器要求客户端的认证信息 |
| Range | 实体的字节范围请求 |
| Referer | 对请求中 URI 的原始获取方 |
| TE | 传输编码的优先级 |
| User-Agent  | HTTP 客户端程序的信息 |

> 响应首部字段

| 字段名称 | 字段作用 |
| :- | :- |
| Accept-Ranges | 是否接受字节范围请求 |
| Age | 推算资源创建经过时间 |
| ETag | 资源的匹配信息 |
| Location | 令客户端重定向至指定URI |
| Proxy-Authenticate | 代理服务器对客户端的认证信息 |
| Retry-After | 对再次发起请求的时机要求 |
| Server HTTP | 服务器的安装信息 |
| Vary | 代理服务器缓存的管理信息 |
| WWW-Authenticate | 服务器对客户端的认证信息 |

> 实体首部字段

| 字段名称 | 字段作用 |
| :- | :- |
| Allow | 资源可支持的HTTP方法 |
| Content-Encoding | 实体主体适用的编码方式 |
| Content-Language | 实体主体的自然语言 |
| Content-Length | 实体主体的大小（单位：字节） |
| Content-Location | 替代对应资源的URI |
| Content-MD5 | 实体主体的报文摘要 |
| Content-Range | 实体主体的位置范围 |
| Content-Type | 实体主体的媒体类型 |
| Expires | 实体主体过期的日期时间 |
| Last-Modified | 资源的最后修改日期时间 |

## 状态码

**状态码是客户端向服务端发送请求时，描述返回的请求结果，以3位数字和原因短语组成，数字中的第一位指定了响应类别，后两位无分类。响应类别有5种**

* 状态码类别

| 状态码 | 类别 | 原因短语 |
| :-: | :-: | :-: |
| 1xx | informational（信息性状态码） | 接收的请求正在处理 |
| 2xx | Success（成功状态码） | 请求正常处理完毕 |
| 3xx | Redirection（重定向状态码） | 需要进行附加操作以完成请求 |
| 4xx | Client Error（客户端错误状态码） | 服务器无法处理请求 |
| 5xx | Server Error（服务器错误状态码） | 服务器处理请求出错 |

* 具有代表性的14个状态码

>仅记录在RFC2616上的HTTP状态码就达40种，若再加上WebDAV和附加的HTTP状态码等扩展，数量就达60余种

>在响应报文内，随状态码一起返回的信息会因方法的不同而发生改变。比如，使用GET方法时，对应请求资源的实体
>会作为响应返回；而使用HEAD方法时，对应请求资源的实体主体不随报文首部作为响应返回（即在响应中只返回首部，
>不会返回实体的主体部分）

| 状态码 | 类别 | 作用 |
| :- | :- | :- |
| 200 OK | Success | 表示从客户端发来的请求在服务器端被正常处理了 |
| 204 No Content | Success | 该状态码代表服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分。另外，也不允许返回任何实体的主体。比如，当浏览器发出请求处理后，返回204响应，那么浏览器显示的页面不发生任何更新，一般在只需要从客户端往服务器端发送信息，而客户端不需要发送新信息内容的情况下使用 |
| 206 Partial Content | Success | 该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。响应报文中包含由Content-Range指定范围的实体内容 |
| 301 Moved Permanently | Redirection | 永久重定向，该状态码表示请求的资源已被分配了新的URI，以后应使用资源现在所指向的URI |
| 302 Found | Redirection | 临时重定向，该状态码表示请求的资源已被分配了新的URI，希望用户（本次）能使用新的URI访问 |
| 303 See Other | Redirection | 该状态码表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源 |
| 304 Not Modified | Redirection |  |
| 307 Temporary Redirect | Redirection |  临时重定向 |
| 400 Bad Request | Client Error |  该状态码表示请求报文中存在语法错误 |
| 401 Unauthorized | Client Error |  该状态码表示发送的请求需要有通过HTTP认证的认证信息，如果之前已经进行过1次请求，则表示用户认证失败 |
| 403 Forbidden | Client Error | 该状态码表明对请求资源的访问被服务器拒绝了。服务端没有必要给出拒绝的详细理由，但如果想作说明的话，可以在实体的主体部分对原因进行描述，这样就能让用户看到了 |
| 404 Not Found | Client Error | 该状态码表明服务器上无法找到请求的资源 |
| 500 Internal Server Error | Server Error | 该状态码表明服务器端在执行请求时发生了错误 |
| 503 Server Unavailable | Server Error | 该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求 |

##  代理

**代理是一种有转发功能的应用程序，他扮演了位于服务器和客户端「中间人」的角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端**

* 缓存代理

代理转发响应时，缓存代理会预先将资源的副本「缓存」保存在代理服务器上，当代理再次接受到对相同资源的请求时，就可以不从源服务器那里获取资源，而是将之前的缓存资源作为响应返回

* 透明代理

转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理。反之，对报文内容进行加工的代理被称为非透明代理

## 网关

**网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，他就像自己拥有资源的服务器一样对请求进行处理。有时客户端可能都不会察觉，自己通信目标是一个网关**

## 隧道

**隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保证双方通信连接的应用程序**